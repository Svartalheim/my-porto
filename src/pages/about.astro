---
import Layout from '../layouts/layout.astro';
import AboutTitle from '@assets/svg/about-title.svg';
import FacetTitle from '@assets/svg/facet-title.svg';

import Arrow from '@assets/svg/arrow.svg';
import Flare from '@assets/svg/flare.svg';
import ImageAboutNavbar from '@assets/images/about.png';
import { Image } from 'astro:assets';
import { Separator } from '@components/ui/separator';

type SpecialitiesItem = { header: string; desc: string };
const SPECIALITIES: SpecialitiesItem[] = [
  {
    header: '3 years of experience',
    desc: 'Production UIs shipped with React/Next.js, Astro, and TypeScript. I target fast loads, solid a11y (WCAG 2.1), and clean component architecture—comfortable collaborating across time zones.',
  },
  {
    header: 'Innovation Aligned',
    desc: 'I use modern tools only when they move metrics: View Transitions API, TanStack Router/Query, GSAP/Lenis, edge rendering. Outcomes first—faster pages, smoother flows, higher conversion.',
  },
  {
    header: 'Full custom approach',
    desc: 'No templates. I design brand-matched components, type-safe data flows, and scalable structure. You get maintainable code, clear docs, and a smooth handover—no theme lock-in.',
  },
];
---

<Layout title='about' name='about'>
  <div class='lg:p-[8.333vw] p-[2.333vw]'>
    <div
      class='flex justify-center lg:block px-4 mb-20 [&>*]:w-full [&>*]:h-auto'
      id='about-title'
    >
      <AboutTitle />
    </div>
    <div id='about-header' class='flex justify-center flex-col'>
      <div class='bg-black rounded-[5px] w-[80%] mx-auto overflow-hidden'>
        <Image src={ImageAboutNavbar} alt='about' class='scale-[101%]' />
      </div>
      <Arrow class={'my-12 mx-auto'} />
      <header id='about-hero' class='space-y-5 text-center w-[80%] mx-auto'>
        <p class='p-large'>An Indie Web Developer</p>
        <p class='p-medium font-light'>
          Web Developer based in Indonesia. Presently engaged as a front-end web
          engineer operating on a fulltime basis. Open for a remote position
          anywhere.
        </p>
        <p class='p-medium font-light'>
          I’ve always believed the best websites don’t just look good — they
          make an impact.
        </p>
      </header>
    </div>
  </div>
  <div class='bg-primary text-background -mx-[5vw] px-[7vw]'>
    <section
      id='whats-different'
      class='mt-[100px] pb-[100px] py-[50px] lg:p-[8.333vw] p-[2.333vw] px-0'
    >
      <div
        class='flex justify-center lg:block px-4 mb-20 [&>*]:w-full [&>*]:h-auto [&_*]:fill-white'
        id='about-title'
      >
        <FacetTitle />
      </div>
      <div class='pb-[4.333vw] flex gap-4 p-medium font-light mx-auto'>
        <Flare height={40} width={40} class={'min-w-[40px] h-auto'} />
        <span>
          Whether it’s a small project or a large-scale build for established
          brands, I create digital experiences that stand out and give
          businesses a competitive edge.
        </span>
      </div>
      <Separator className={'bg-background'} />
      <div class='p-medium gap-4 font-light flex flex-col'>
        {
          SPECIALITIES.map((item, index) => (
            <>
              <div
                class='pb-[2.333vw] pt-5 space-y-6'
                id={`speciality-${index}`}
              >
                <h3 class='p-large font-medium'>{item.header}</h3>
                <p
                  class='p-small font-light speciality-desc -mt-[2vw]'
                  data-index={index}
                >
                  {item.desc}
                </p>
              </div>
              <div class='pb-[4.333vw]'>
                <Separator className={'bg-background '} />
              </div>
            </>
          ))
        }
      </div>
    </section>
    <section id='why-us'>
      <div
        class='lg:pr-[var(--size-20)] lg:w-[calc(100%-31.458333333333332vw)] lg:flex flex-col justify-between'
      >
        <div class='lg:pt-[0.20833333333333334vw]'>
          <div class='section-indent'>
            <div
              class='inline-flex absolute left-0 section_name invisible opacity-0 width-view-indent'
            >
              Why atoll
            </div>
            <div
              class='section_name -mb-4 lg:mb-[-1.5277777777777777vw] pointer-events-none'
            >
              Why atoll
            </div>
            <div>
              <h2
                class='p-large'
                data-anim-splitting-scroll=''
                data-splitting-lines-overflow=''
                data-splitting=''
                style='opacity: 1; visibility: inherit;'
              >
                <div class='wrapper_line'>
                  <div
                    class='line'
                    style='display: block; text-align: start; position: relative; translate: none; rotate: none; scale: none; transform: translate(0px, 0px);'
                  >
                    <span
                      class='mr-[8.472222222222223vw] indent-margin-right'
                      style='margin-right: 89.3907px;'></span> Atoll Digital is born
                    from the
                  </div>
                </div>
                <div class='wrapper_line'>
                  <div
                    class='line'
                    style='display: block; text-align: start; position: relative; translate: none; rotate: none; scale: none; transform: translate(0px, 0px);'
                  >
                    dynamic fusion of design, technology,
                  </div>
                </div><div class='wrapper_line'>
                  <div
                    class='line'
                    style='display: block; text-align: start; position: relative; translate: none; rotate: none; scale: none; transform: translate(0px, 0px);'
                  >
                    and business development, crafting
                  </div>
                </div><div class='wrapper_line'>
                  <div
                    class='line'
                    style='display: block; text-align: start; position: relative; translate: none; rotate: none; scale: none; transform: translate(0px, 0px);'
                  >
                    captivating, functional solutions for
                  </div>
                </div><div class='wrapper_line'>
                  <div
                    class='line'
                    style='display: block; text-align: start; position: relative; translate: none; rotate: none; scale: none; transform: translate(0px, 0px);'
                  >
                    businesses.
                  </div>
                </div>
              </h2>
            </div>
          </div>
        </div>
        <div class='lg:hidden mt-[13px] mb-[38px]'>
          <div class='overflow-hidden rounded-[var(--rounded-base)]'>
            <img
              src='https://atolldigital.com/wp-content/uploads/2025/02/Atoll_Fusion_Des_Dev_Mobile.webp'
              class='w-full h-auto'
            />
          </div>
        </div>
        <div
          class='lg:max-w-[31.458333333333332vw] lg:ml-auto lg:mt-[5.555555555555555vw]'
        >
          <div class='description'>
            With us, you tap into a vibrant mix of functional<br />
            creativity, innovation, and business-centric goals.<br />
            We pack a punch with tailored website solutions<br />
            that resonate with top brands' objectives.<br />
            With Our close-knit team, you receive personalized<br />
            attention and effortless integration with your<br />
            team’s goals.
          </div>
        </div>
      </div>
    </section>
  </div>
  <!-- <h1 class='text-4xl font-bold mb-8'>About Me</h1> -->
  <!-- <div class='max-w-4xl mx-auto px-4 py-12'>
    <a href={'/'} title='home' class='inline-block'> awawaa </a>

    <div class='grid md:grid-cols-2 gap-8 items-center'>
      <div>
        <p class='text-lg text-gray-600 mb-6'>
          Welcome to my portfolio! I'm a passionate developer who loves creating
          amazing digital experiences.
        </p>

        <div class='space-y-4'>
          <h2 class='text-2xl font-semibold'>Skills</h2>
          <div class='flex flex-wrap gap-2'>
            <span
              class='px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm'
              >JavaScript</span
            >
            <span
              class='px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm'
              >TypeScript</span
            >
            <span
              class='px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm'
              >React</span
            >
            <span
              class='px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm'
              >Astro</span
            >
            <span
              class='px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm'
              >GSAP</span
            >
          </div>
        </div>
      </div>

      <div class='bg-gray-200 h-64 rounded-lg flex items-center justify-center'>
        <span class='text-gray-500'>Your Photo Here</span>
      </div>
    </div>
  </div> -->
</Layout>
<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';
  gsap.registerPlugin(ScrollTrigger);

  // keep track of just our triggers
  let specialityTriggers = new Set();

  function killSpecialities() {
    specialityTriggers.forEach((t: any) => t.kill());
    specialityTriggers.clear();
  }

  function initSpecialitiesAnimation() {
    killSpecialities(); // prevent duplicates
    console.log('initSpecialitiesAnimation');
    const descriptions = document.querySelectorAll('.speciality-desc');
    if (!descriptions.length) return;

    // Set initial state - hide all descriptions
    gsap.set(descriptions, {
      opacity: 0,
      y: 'auto',
      height: 0,
      overflow: 'hidden',
    });

    descriptions.forEach((desc, index) => {
      const container = document.getElementById(`speciality-${index}`);
      if (!container) return;

      const id = `speciality-${index}`;
      // extra safety if something slipped through:
      const existing = ScrollTrigger.getById(id);
      if (existing) existing.kill();

      const tween = gsap.to(desc, {
        opacity: 1,
        y: 0,
        height: 'auto',
        duration: 0.6,
        ease: 'power2.out',
        scrollTrigger: {
          id,
          trigger: container,
          start: 'top 70%',
          end: 'bottom 50%',
          toggleActions: 'play none none reverse',
          markers: true, // Disabled for production
        },
      });

      // store the created ScrollTrigger instance
      specialityTriggers.add(tween.scrollTrigger);
    });

    // Force ScrollTrigger refresh after setup
    setTimeout(() => {
      ScrollTrigger.refresh();
    }, 100);
  }

  // Astro View Transitions lifecycle
  document.addEventListener('astro:before-swap', killSpecialities);

  document.addEventListener('astro:page-load', () => {
    // Multiple timing strategies to ensure proper initialization
    requestAnimationFrame(() => {
      initSpecialitiesAnimation();
    });

    // Backup initialization with longer delay for complex layouts
    setTimeout(() => {
      initSpecialitiesAnimation();
    }, 200);
  });

  // Also handle the initial page load (non-transition)
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(initSpecialitiesAnimation, 100);
    });
  } else {
    setTimeout(initSpecialitiesAnimation, 100);
  }
</script>
